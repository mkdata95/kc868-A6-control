# KC868-A6 스마트 릴레이 제어 시스템 🏠⚡

완벽하게 작동하는 KC868-A6 릴레이 제어 웹 인터페이스입니다. 모든 버그가 해결되었고, 사용자 친화적인 기능들이 완성되었습니다.

## ✨ 주요 기능

### 🎮 릴레이 제어
- **6개 릴레이 개별 제어**: ON/OFF 토글 스위치
- **실시간 상태 표시**: 현재 릴레이 상태 확인
- **전체 제어**: 모든 릴레이 한번에 켜기/끄기
- **애플 스타일 UI**: 세련된 디자인과 부드러운 애니메이션

### 🎨 커스터마이징
- **스위치 이름 편집**: 더블클릭으로 인라인 편집
- **아이콘 선택**: 60+ 전자제품/조명 아이콘
- **긴급 리셋**: 아이콘 버그 발생시 즉시 복구
- **데이터베이스 저장**: 설정이 영구적으로 보존

### 📅 스케줄 시스템
- **주간 스케줄**: 요일별 ON/OFF 시간 설정
- **백그라운드 실행**: 자동으로 스케줄 체크
- **웹 인터페이스**: 쉬운 스케줄 관리
- **SQLite 저장**: 안정적인 데이터 보관

## 🛠️ 해결된 문제들

### 🔧 아이콘 버그 완전 해결
- **존재하지 않는 아이콘 제거**: Font Awesome에서 지원하지 않는 아이콘들 교체
- **안전한 기본값**: 모든 스위치에 확실히 존재하는 아이콘 적용
- **긴급 리셋 기능**: 문제 발생시 즉시 복구 가능
- **유효성 검사**: 아이콘 선택시 `fa-` 접두사 검증

### 📡 네트워크 연결 안정화
- **WiFi 설정 수정**: 올바른 네트워크 정보 적용
- **API 엔드포인트 발견**: `___숫자` 패턴으로 한글 스위치명 처리
- **상태 표시 안정화**: 캐시 시스템으로 네트워크 지연 해결
- **오류 처리 강화**: 연결 실패시 데모 모드 자동 전환

## 🚀 설치 및 실행

### 1. 의존성 설치
```bash
pip install -r requirements.txt
```

### 2. ESPHome 펌웨어 업로드
```bash
# WiFi 설정 확인 (DIDBANK-2.4G, 비밀번호: !mk614873011)
esphome run kc868-a6-correct.yaml
```

### 3. 웹서버 실행
```bash
python app.py
```

### 4. 웹 인터페이스 접속
- http://localhost:5000

## 📋 기본 설정

### 스위치 기본값
- **스위치 1**: 메인 조명 💡 (fa-lightbulb)
- **스위치 2**: TV 📺 (fa-tv)
- **스위치 3**: 에어컨 ❄️ (fa-snowflake)
- **스위치 4**: 선풍기 🌀 (fa-fan)
- **스위치 5**: 오디오 🎵 (fa-music)
- **스위치 6**: 기타 🏠 (fa-home)

### 하드웨어 설정
- **I2C 설정**: SDA=GPIO4, SCL=GPIO15 (⚠️ 중요: GPIO5가 아님!)
- **PCF8574 주소**: 0x24 (릴레이), 0x22 (입력)
- **WiFi**: DIDBANK-2.4G 네트워크

## 🎯 사용 방법

### 기본 제어
1. 웹 브라우저에서 http://localhost:5000 접속
2. 각 스위치 카드 클릭으로 ON/OFF 제어
3. 실시간으로 상태 확인 가능

### 커스터마이징
1. **이름 변경**: 스위치 이름을 더블클릭하여 편집
2. **아이콘 변경**: 스위치 카드의 아이콘 편집 버튼 클릭
3. **리셋**: 문제 발생시 "아이콘 리셋" 버튼 클릭

### 스케줄 설정
1. "스케줄 설정" 버튼 클릭
2. 스위치, 요일, 시간 선택
3. 스케줄 이름 입력 후 추가
4. 백그라운드에서 자동 실행

## 🔧 문제 해결

### 아이콘이 깨져서 편집할 수 없는 경우
1. **즉시 해결**: 빨간색 "아이콘 리셋" 버튼 클릭
2. **확인**: 모든 스위치가 기본 아이콘으로 복구됨
3. **재편집**: 정상적으로 아이콘 편집 가능

### 릴레이가 작동하지 않는 경우
1. **WiFi 연결 확인**: ESPHome 펌웨어 상태 체크
2. **IP 주소 확인**: KC868-A6의 실제 IP 주소 확인
3. **펌웨어 재업로드**: ESPHome 설정 파일로 다시 업로드

### 상태 표시가 불안정한 경우
- 웹페이지 새로고침으로 해결
- 캐시 시스템이 자동으로 안정화

## 📁 파일 구조

```
KC8668-A6/
├── app.py                          # Flask 웹서버 (메인)
├── templates/dashboard.html        # 웹 인터페이스
├── requirements.txt               # Python 의존성
├── kc868-a6-*.yaml               # ESPHome 설정 파일들
├── 개발주의사항.md                 # 개발 과정 기록
├── README.md                      # 이 파일
└── kc868_*.db                     # SQLite 데이터베이스 파일들
```

## 🎨 지원되는 아이콘

### 전자제품 (20개)
TV, 에어컨, 선풍기, 블렌더, 커피머신, 토스터, 청소기, 세탁기, 건조기, 다리미, PC, 노트북, 프린터, 서버, WiFi, 라우터, 히터, 온수기, 냉방기, 급수펌프

### 조명 (25개)
전구, 테이블램프, 데스크램프, 플로어램프, 실링팬, 원형조명, 샹들리에, 펜던트, 크리스탈, 디자인조명, LED, RGB, LED스트립, 조광등, 스마트등, 독서등, 작업등, 확대등, 스포트라이트, 다운라이트, 가로등, 현관등, 정원등, 보안등, 투광등

### 기타 (15개)
센서등, 무드등, 캔들, 로맨틱조명, 파티등, 무지개조명, 사각등, 매입등, 패널등, 라인등, 태양광, 비상등, 난로등, 쿨링등, 수영장

## 🔄 백업 정보

- **마지막 백업**: 아이콘 버그 수정 완료 후
- **Git 저장소**: https://github.com/mkdata95/kc868-A6-control.git
- **주요 변경사항**: 아이콘 리셋 기능 추가, 모든 버그 해결

## 📞 지원

문제가 발생하면:
1. **긴급 리셋**: "아이콘 리셋" 버튼 사용
2. **페이지 새로고침**: 간단한 문제는 F5로 해결
3. **로그 확인**: Flask 서버 콘솔에서 오류 메시지 확인

---

**✅ 완벽하게 작동하는 KC868-A6 제어 시스템입니다!** 🎉  
**모든 버그가 해결되었고, 안정적으로 사용할 수 있습니다.** 🚀 